(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[859],{6859:(e,s,a)=>{"use strict";a.d(s,{A:()=>d});var t=a(5155),r=a(2115),l=a(6694);function c(e){let{onVideoRecorded:s}=e,[a,l]=(0,r.useState)(!1),[c,n]=(0,r.useState)(!1),[i,o]=(0,r.useState)(0),[d,u]=(0,r.useState)(null),[m,h]=(0,r.useState)([]),[g,v]=(0,r.useState)(null),[p,x]=(0,r.useState)(!0),j=(0,r.useRef)(null),f=(0,r.useRef)(null),N=(0,r.useRef)(null);(0,r.useEffect)(()=>{navigator.mediaDevices&&window.MediaRecorder||x(!1)},[]);let b=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});u(e),j.current&&(j.current.srcObject=e)}catch(e){console.error("Error accessing camera and microphone:",e),alert("Please allow access to your camera and microphone to record a video message.")}},S=()=>{for(let e of["video/webm;codecs=vp9,opus","video/webm;codecs=vp8,opus","video/webm;codecs=h264,opus","video/webm","video/mp4"])if(MediaRecorder.isTypeSupported(e))return e;return null},w=()=>{f.current&&a&&(f.current.stop(),l(!1),n(!1),N.current&&(clearInterval(N.current),N.current=null))},y=e=>{let s=Math.floor(e/60);return"".concat(s.toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0"))};return(0,r.useEffect)(()=>()=>{d&&d.getTracks().forEach(e=>e.stop()),N.current&&clearInterval(N.current),g&&URL.revokeObjectURL(g)},[d,g]),(0,r.useEffect)(()=>{if(m.length>0&&!a){let e=new Blob(m,{type:"video/webm"});v(URL.createObjectURL(e)),s(e)}},[m,a,s]),(0,t.jsx)("div",{className:"video-recorder-container",children:p?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"video-preview-container",children:g?(0,t.jsx)("video",{src:g,controls:!0,className:"video-preview"}):(0,t.jsx)("video",{ref:j,autoPlay:!0,muted:!0,playsInline:!0,className:"video-preview"})}),(0,t.jsxs)("div",{className:"recording-controls",children:[!d&&!a&&(0,t.jsx)("button",{onClick:b,className:"camera-btn",children:"Enable Camera"}),d&&!a&&!g&&(0,t.jsx)("button",{onClick:()=>{if(d)try{let e=S(),s=new MediaRecorder(d,e?{mimeType:e}:void 0);f.current=s,s.ondataavailable=e=>{e.data&&e.data.size>0&&h(s=>[...s,e.data])},s.start(1e3),l(!0),n(!1),o(0),N.current=setInterval(()=>{o(e=>e+1)},1e3)}catch(e){console.error("Error starting recording:",e),alert("There was an error starting the recording. Your browser may not support this feature.")}},className:"record-btn",children:"Start Recording"}),a&&!c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"recording-indicator",children:[(0,t.jsx)("span",{className:"recording-dot"}),(0,t.jsx)("span",{className:"recording-time",children:y(i)})]}),(0,t.jsxs)("div",{className:"recording-buttons",children:[(0,t.jsx)("button",{onClick:()=>{f.current&&a&&!c&&(f.current.pause(),n(!0),N.current&&(clearInterval(N.current),N.current=null))},className:"pause-btn",children:"Pause"}),(0,t.jsx)("button",{onClick:w,className:"stop-btn",children:"Stop"})]})]}),a&&c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"recording-indicator paused",children:(0,t.jsxs)("span",{className:"recording-time",children:[y(i)," (Paused)"]})}),(0,t.jsxs)("div",{className:"recording-buttons",children:[(0,t.jsx)("button",{onClick:()=>{f.current&&a&&c&&(f.current.resume(),n(!1),N.current=setInterval(()=>{o(e=>e+1)},1e3))},className:"resume-btn",children:"Resume"}),(0,t.jsx)("button",{onClick:w,className:"stop-btn",children:"Stop"})]})]}),g&&(0,t.jsx)("button",{onClick:()=>{v(null),h([]),b()},className:"retake-btn",children:"Record Again"})]})]}):(0,t.jsxs)("div",{className:"browser-not-supported",children:[(0,t.jsx)("div",{className:"not-supported-icon",children:"⚠️"}),(0,t.jsx)("h4",{children:"Browser Not Supported"}),(0,t.jsx)("p",{children:"Your browser doesn't support video recording. Please try using a modern browser like Chrome, Firefox, or Edge."})]})})}function n(e){let{videoBlob:s,onSchedule:a}=e,[l,c]=(0,r.useState)(""),[n,i]=(0,r.useState)(""),[o,d]=(0,r.useState)(""),[u,m]=(0,r.useState)(""),[h,g]=(0,r.useState)(""),v=new Date().toISOString().split("T")[0];return(0,t.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!s)return void alert("Please record a video first.");if(!l||!n||!o||!u)return void alert("Please fill in all required fields.");let t=new Date("".concat(n,"T").concat(o));if(t<=new Date)return void alert("Please select a future date and time.");a({recipientEmail:l,scheduledDate:t.toISOString(),subject:u,message:h}),c(""),i(""),d(""),m(""),g("")},className:"video-scheduler-form",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"recipient-email",children:"Recipient Email *"}),(0,t.jsx)("input",{id:"recipient-email",type:"email",value:l,onChange:e=>c(e.target.value),placeholder:"Enter recipient's email",required:!0,className:"scheduler-input"})]}),(0,t.jsxs)("div",{className:"form-row",children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"scheduled-date",children:"Date *"}),(0,t.jsx)("input",{id:"scheduled-date",type:"date",value:n,onChange:e=>i(e.target.value),min:v,required:!0,className:"scheduler-input"})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"scheduled-time",children:"Time *"}),(0,t.jsx)("input",{id:"scheduled-time",type:"time",value:o,onChange:e=>d(e.target.value),required:!0,className:"scheduler-input"})]})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"subject",children:"Subject *"}),(0,t.jsx)("input",{id:"subject",type:"text",value:u,onChange:e=>m(e.target.value),placeholder:"Enter message subject",required:!0,className:"scheduler-input"})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"message",children:"Message (optional)"}),(0,t.jsx)("textarea",{id:"message",value:h,onChange:e=>g(e.target.value),placeholder:"Add a personal message...",className:"scheduler-textarea"})]}),(0,t.jsx)("button",{type:"submit",className:"schedule-btn",disabled:!s,children:"Schedule Message"})]})}function i(e){let{messages:s,onDelete:a}=e;return(0,t.jsx)("div",{className:"video-message-list",children:0===s.length?(0,t.jsx)("p",{className:"text-pink-300 text-center italic",children:"No scheduled video messages yet."}):(0,t.jsx)("div",{className:"message-list",children:s.map(e=>{let s=new Date(e.scheduledDate),r=e.delivered,c=!r&&s>new Date,n=!r&&s<=new Date;return(0,t.jsxs)("div",{className:"message-item ".concat(r?"delivered":""," ").concat(c?"pending":""," ").concat(n?"overdue":""),children:[(0,t.jsxs)("div",{className:"message-header",children:[(0,t.jsx)("h4",{className:"message-subject",children:e.subject}),(0,t.jsxs)("div",{className:"message-status",children:[r&&(0,t.jsx)("span",{className:"status delivered",children:"Delivered"}),c&&(0,t.jsx)("span",{className:"status pending",children:"Pending"}),n&&(0,t.jsx)("span",{className:"status overdue",children:"Processing"})]})]}),(0,t.jsxs)("div",{className:"message-details",children:[(0,t.jsxs)("p",{className:"message-recipient",children:[(0,t.jsx)("span",{className:"label",children:"To:"})," ",e.recipientEmail]}),(0,t.jsxs)("p",{className:"message-date",children:[(0,t.jsx)("span",{className:"label",children:"Scheduled for:"})," ",(0,l.GP)(s,"MMM d, yyyy h:mm a")]}),e.message&&(0,t.jsxs)("p",{className:"message-text",children:[(0,t.jsx)("span",{className:"label",children:"Message:"})," ",e.message]})]}),(0,t.jsx)("div",{className:"message-actions",children:!r&&(0,t.jsx)("button",{onClick:()=>a(e.id),className:"delete-message-btn",children:"Cancel"})})]},e.id)})})})}function o(e){let{message:s,show:a,onClose:l}=e,[c,n]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{if(a){n(!0);let e=setTimeout(()=>{n(!1),l()},5e3);return()=>clearTimeout(e)}n(!1)},[a,l]),c&&s)?(0,t.jsx)("div",{className:"delivery-notification",children:(0,t.jsxs)("div",{className:"notification-content",children:[(0,t.jsx)("div",{className:"notification-icon",children:"✉️"}),(0,t.jsxs)("div",{className:"notification-text",children:[(0,t.jsx)("h4",{children:"Message Delivered!"}),(0,t.jsxs)("p",{children:['Your video message "',s.subject,'" has been delivered to ',s.recipientEmail,"."]})]}),(0,t.jsx)("button",{className:"notification-close",onClick:l,children:"✕"})]})}):null}function d(){let[e,s]=(0,r.useState)(null),[a,l]=(0,r.useState)([]),[d,u]=(0,r.useState)(!1),[m,h]=(0,r.useState)(null),g=(0,r.useRef)([]),v=(0,r.useRef)(null);(0,r.useEffect)(()=>{g.current=a},[a]);let p=(0,r.useCallback)(async()=>{try{let e=await fetch("http://localhost:3001/api/messages");if(e.ok){let s=await e.json();l(s),g.current=s,localStorage.setItem("videoMessages",JSON.stringify(s))}else{let e=localStorage.getItem("videoMessages");if(e){let s=JSON.parse(e);l(s),g.current=s}}}catch(e){console.error("Error loading messages:",e);try{let e=localStorage.getItem("videoMessages");if(e){let s=JSON.parse(e);l(s),g.current=s}}catch(e){console.error("Error loading messages from localStorage:",e)}}},[]),x=(0,r.useCallback)(async()=>{try{let e=await fetch("http://localhost:3001/api/messages");if(!e.ok)throw Error("Server responded with ".concat(e.status,": ").concat(e.statusText));let s=await e.json(),a=g.current,t=null;for(let e of s){let s=a.find(s=>s.id===e.id);if(s&&!s.delivered&&e.delivered){t=e;break}}l(s),g.current=s,localStorage.setItem("videoMessages",JSON.stringify(s)),t&&(h(t),u(!0))}catch(e){console.error("Error checking delivery:",e)}},[]);(0,r.useEffect)(()=>(p(),x(),v.current=setInterval(x,6e4),()=>{v.current&&(clearInterval(v.current),v.current=null)}),[p,x]);let j=(0,r.useCallback)(e=>{s(e)},[]),f=(0,r.useCallback)(async a=>{if(e)try{let t=new FormData;t.append("video",e,"video.webm"),t.append("recipientEmail",a.recipientEmail),t.append("scheduledDate",a.scheduledDate),t.append("subject",a.subject),a.message&&t.append("message",a.message);let r=await fetch("http://localhost:3001/api/schedule",{method:"POST",body:t});if(!r.ok)throw Error("Server responded with ".concat(r.status,": ").concat(r.statusText));let c=await r.json(),n=[...g.current,{...c,videoData:"stored_on_server"}];localStorage.setItem("videoMessages",JSON.stringify(n)),l(n),g.current=n,s(null),alert("Your video message has been scheduled successfully!")}catch(e){console.error("Error scheduling video message:",e),alert("There was an error scheduling your video message. Please try again.")}},[e]),N=(0,r.useCallback)(async e=>{try{let s=await fetch("http://localhost:3001/api/messages/".concat(e),{method:"DELETE"});if(!s.ok)throw Error("Server responded with ".concat(s.status,": ").concat(s.statusText));let a=g.current.filter(s=>s.id!==e);localStorage.setItem("videoMessages",JSON.stringify(a)),l(a),g.current=a}catch(e){console.error("Error deleting message:",e),alert("There was an error deleting the message. Please try again.")}},[]);return(0,t.jsxs)("div",{className:"video-message-section",children:[(0,t.jsx)("h2",{className:"video-message-title",children:"Scheduled Video Messages"}),(0,t.jsx)("p",{className:"video-message-subtitle",children:"Record a special video message and schedule it to be delivered to your loved one at the perfect moment"}),(0,t.jsxs)("div",{className:"video-message-container",children:[(0,t.jsxs)("div",{className:"video-recorder-container",children:[(0,t.jsx)("h3",{className:"text-xl font-semibold text-pink-400 mb-2",children:"Record Your Message"}),(0,t.jsx)(c,{onVideoRecorded:j})]}),(0,t.jsxs)("div",{className:"video-scheduler-container",children:[(0,t.jsx)("h3",{className:"text-xl font-semibold text-pink-400 mb-2",children:"Schedule Delivery"}),(0,t.jsx)(n,{videoBlob:e,onSchedule:f})]})]}),(0,t.jsxs)("div",{className:"video-message-list-container",children:[(0,t.jsx)("h3",{className:"text-xl font-semibold text-pink-400 mb-2 mt-6",children:"Your Scheduled Messages"}),(0,t.jsx)(i,{messages:a,onDelete:N},a.length)]}),(0,t.jsx)(o,{message:m,show:d,onClose:()=>u(!1)})]})}a(7338)},7338:()=>{}}]);